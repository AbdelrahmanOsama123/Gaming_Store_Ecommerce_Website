!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@thi.ng/checks"),require("@thi.ng/compare"),require("@thi.ng/equiv"),require("@thi.ng/errors"),require("@thi.ng/random"),require("@thi.ng/transducers")):"function"==typeof define&&define.amd?define(["exports","@thi.ng/checks","@thi.ng/compare","@thi.ng/equiv","@thi.ng/errors","@thi.ng/random","@thi.ng/transducers"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).thi=t.thi||{},t.thi.ng=t.thi.ng||{},t.thi.ng.dcons={}),t.thi.ng.checks,t.thi.ng.compare,t.thi.ng.equiv,t.thi.ng.errors,t.thi.ng.random,t.thi.ng.transducers)}(this,(function(t,e,i,h,s,r,n){"use strict";class l{constructor(t){this._length=0,t&&this.into(t)}get length(){return this._length}copy(){return new l(this)}empty(){return new l}clear(){this.release()}release(){let t,e=this.head;for(;e;)t=e.next,delete e.value,delete e.prev,delete e.next,e=t;return delete this.head,delete this.tail,this._length=0,!0}compare(t){const e=this._length;if(e<t._length)return-1;if(e>t._length)return 1;if(0===e)return 0;{let e=this.head,h=t.head,s=0;for(;e&&0==s;)s=i.compare(e.value,h.value),e=e.next,h=h.next;return s}}equiv(t){if(!(t instanceof l||e.isArrayLike(t))||this._length!==t.length)return!1;if(!this._length||this===t)return!0;let i=this.head;for(let e of t){if(!h.equiv(i.value,e))return!1;i=i.next}return!0}*[Symbol.iterator](){let t=this.head;for(;t;)yield t.value,t=t.next}seq(t=0,e=this.length){if(t>=e||t<0)return;let i=this.nthCell(t);const h=this.nthCell(e-1),s=t=>({first:()=>t.value,next:()=>t!==h&&t.next?s(t.next):void 0});return i?s(i):void 0}*cycle(){for(;;)yield*this}$reduce(t,e){let i=this.head;for(;i&&!n.isReduced(e);)e=t(e,i.value),i=i.next;return e}drop(){const t=this.head;if(t)return this.head=t.next,this.head?delete this.head.prev:delete this.tail,this._length--,t.value}cons(t){const e={value:t,next:this.head};return this.head?this.head.prev=e:this.tail=e,this.head=e,this._length++,this}insertBefore(t,e){t||s.illegalArgs("cell is undefined");const i={value:e,next:t,prev:t.prev};return t.prev?t.prev.next=i:this.head=i,t.prev=i,this._length++,this}insertAfter(t,e){t||s.illegalArgs("cell is undefined");const i={value:e,next:t.next,prev:t};return t.next?t.next.prev=i:this.tail=i,t.next=i,this._length++,this}insertBeforeNth(t,e){return t<0&&(t+=this._length),t<=0?this.cons(e):(s.ensureIndex(t,0,this._length),this.insertBefore(this.nthCellUnsafe(t),e))}insertAfterNth(t,e){return t<0&&(t+=this._length),t>=this._length-1?this.push(e):(s.ensureIndex(t,0,this._length),this.insertAfter(this.nthCellUnsafe(t),e))}insertSorted(t,e){e=e||i.compare;let h=this.head;for(;h;){if(e(t,h.value)<=0)return this.insertBefore(h,t);h=h.next}return this.push(t)}find(t){let e=this.head;for(;e;){if(e.value===t)return e;e=e.next}}findWith(t){let e=this.head;for(;e;){if(t(e.value))return e;e=e.next}}concat(...t){const e=this.copy();for(let i of t)e.into(i);return e}into(t){for(let e of t)this.push(e)}slice(t=0,e=this.length){let i=t<0?t+this._length:t,h=e<0?e+this._length:e;(i<0||h<0)&&s.illegalArgs("invalid indices: ${from} / ${to}");const r=new l;let n=this.nthCell(i);for(;n&&++i<=h;)r.push(n.value),n=n.next;return r}splice(t,e=0,i){let h;"number"==typeof t?(t<0&&(t+=this._length),s.ensureIndex(t,0,this._length),h=this.nthCellUnsafe(t)):h=t;const r=new l;if(e>0)for(;h&&e-- >0;)this.remove(h),r.push(h.value),h=h.next;else h&&(h=h.next);if(i)if(h)for(let t of i)this.insertBefore(h,t);else for(let t of i)this.push(t);return r}remove(t){return t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,this._length--,this}swap(t,e){if(t!==e){const i=t.value;t.value=e.value,e.value=i}return this}push(t){if(this.tail){const e={value:t,prev:this.tail};return this.tail.next=e,this.tail=e,this._length++,this}return this.cons(t)}pop(){const t=this.tail;if(t)return this.tail=t.prev,this.tail?delete this.tail.next:delete this.head,this._length--,t.value}first(){return this.head&&this.head.value}peek(){return this.tail&&this.tail.value}setHead(t){return this.head?(this.head.value=t,this):this.cons(t)}setTail(t){return this.tail?(this.tail.value=t,this):this.push(t)}setNth(t,e){const i=this.nthCell(t);return!i&&s.illegalArgs(`index out of bounds: ${t}`),i.value=e,this}nth(t,e){const i=this.nthCell(t);return i?i.value:e}nthCell(t){if(t<0&&(t+=this._length),!(t<0||t>=this._length))return this.nthCellUnsafe(t)}rotateLeft(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}rotateRight(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:const t=this.peek();return this.pop(),this.cons(t)}}map(t){const e=new l;let i=this.head;for(;i;)e.push(t(i.value)),i=i.next;return e}filter(t){const e=new l;let i=this.head;for(;i;)t(i.value)&&e.push(i.value),i=i.next;return e}reduce(t,e){let i=e,h=this.head;for(;h;)i=t(i,h.value),h=h.next;return i}shuffle(t,e=r.SYSTEM){if(this._length<2)return this;for(t=null!=t?t:Math.ceil(1.5*Math.log2(this._length));t>0;t--){let t=this.head;for(;t;){const i=t.next;e.float()<.5?this.asHead(t):this.asTail(t),t=i}}return this}sort(t=i.compare){if(!this._length)return this;let e=1;for(;;){let i=this.head;this.head=void 0,this.tail=void 0;let h=0;for(;i;){h++;let s=i,r=0;for(let t=0;t<e&&(r++,s=s.next,s);t++);let n=e;for(;r>0||n>0&&s;){let e;0===r?(e=s,s=s.next,n--):s&&0!==n?t(i.value,s.value)<=0?(e=i,i=i.next,r--):(e=s,s=s.next,n--):(e=i,i=i.next,r--),this.tail?this.tail.next=e:this.head=e,e.prev=this.tail,this.tail=e}i=s}if(this.tail.next=void 0,h<=1)return this;e*=2}}reverse(){let t=this.head,e=this.tail,i=(this._length>>>1)+(1&this._length);for(;t&&e&&i>0;){const h=t.value;t.value=e.value,e.value=h,t=t.next,e=e.prev,i--}return this}asHead(t){return t===this.head||(this.remove(t),this.head.prev=t,t.next=this.head,t.prev=void 0,this.head=t,this._length++),this}asTail(t){return t===this.tail||(this.remove(t),this.tail.next=t,t.prev=this.tail,t.next=void 0,this.tail=t,this._length++),this}toString(){let t=[],e=this.head;for(;e;)t.push(String(e.value)),e=e.next;return t.join(", ")}toJSON(){return[...this]}nthCellUnsafe(t){let e,i;for(t<=this._length>>1?(e=this.head,i="next"):(e=this.tail,i="prev",t=this._length-t-1);t-- >0&&e;)e=e[i];return e}}const a=t=>new l(t),u=a;class o extends l{constructor(t,e){super(e),this._reorder=t}copy(){return new o(this._reorder,this)}empty(){return new o(this._reorder)}nth(t,e){const i=super.nthCell(t);return i?this._reorder(this,i).value:e}setNth(t,e){const i=this.nthCell(t);return!i&&s.outOfBounds(t),this._reorder(this,i).value=e,this}setTail(t){return this.tail?(this.tail.value=t,this._reorder(this,this.tail),this):this.cons(t)}find(t){let e=this.head;for(;e;){if(e.value===t)return this._reorder(this,e);e=e.next}}findWith(t){let e=this.head;for(;e;){if(t(e.value))return this._reorder(this,e);e=e.next}}}t.DCons=l,t.SOL=o,t.dcons=u,t.defDCons=a,t.defMTF=t=>new o(((t,e)=>(t.asHead(e),e)),t),t.defTranspose=t=>new o(((t,e)=>e.prev?(t.swap(e.prev,e),e.prev):e),t),Object.defineProperty(t,"__esModule",{value:!0})}));