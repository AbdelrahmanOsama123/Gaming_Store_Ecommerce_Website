!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@thi.ng/api"),require("@thi.ng/checks"),require("@thi.ng/errors"),require("@thi.ng/compose"),require("@thi.ng/compare"),require("@thi.ng/math"),require("@thi.ng/arrays"),require("@thi.ng/random")):"function"==typeof define&&define.amd?define(["exports","@thi.ng/api","@thi.ng/checks","@thi.ng/errors","@thi.ng/compose","@thi.ng/compare","@thi.ng/math","@thi.ng/arrays","@thi.ng/random"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).thi=e.thi||{},e.thi.ng=e.thi.ng||{},e.thi.ng.transducers={}),e.thi.ng.api,e.thi.ng.checks,e.thi.ng.errors,e.thi.ng.compose,e.thi.ng.compare,e.thi.ng.math,e.thi.ng.arrays,e.thi.ng.random)}(this,(function(e,t,n,r,o,i,u,c,s){"use strict";const l=e=>n.implementsFunction(e,"xform")?e.xform():e;class f{constructor(e){this.value=e}deref(){return this.value}}const a=e=>new f(e),d=e=>e instanceof f,h=e=>e instanceof f?e:new f(e),g=e=>e instanceof f?e.deref():e,p=e=>2===e.length?[void 0,e[1]]:3===e.length?[e[1],e[2]]:r.illegalArity(e.length);function y(...e){const t=e[0],r=t[0],o=t[1],i=t[2],u=null==(e=p(e))[0]?r():e[0],c=e[1];return g(o(n.implementsFunction(c,"$reduce")?c.$reduce(i,u):n.isArrayLike(c)?b(i,u,c):k(i,u,c)))}function m(...e){const t=e[0],n=t[0],r=t[1],o=t[2];let i=null==(e=p(e))[0]?n():e[0];const u=e[1];for(let e=u.length;--e>=0;)if(i=o(i,u[e]),d(i)){i=i.deref();break}return g(r(i))}const b=(e,t,n)=>{for(let r=0,o=n.length;r<o;r++)if(t=e(t,n[r]),d(t)){t=t.deref();break}return t},k=(e,t,n)=>{for(let r of n)if(t=e(t,r),d(t)){t=t.deref();break}return t},O=(e,t)=>[e,e=>e,t],v=(e,t)=>{const r=t.length-1;return n.isIterable(t[r])?t.length>1?y(e.apply(null,t.slice(0,r)),t[r]):y(e(),t[0]):void 0};function w(e){return e?[...e]:O((()=>[]),((e,t)=>(e.push(t),e)))}function*S(e,t){const n=l(e)(w()),r=n[1],o=n[2];for(let e of t){const t=o([],e);if(d(t))return void(yield*g(r(t.deref())));t.length&&(yield*t)}yield*g(r([]))}function*I(e,n){const r=l(e)([t.NO_OP,t.NO_OP,(e,t)=>t])[2];for(let e of n){let n=r(t.SEMAPHORE,e);if(d(n))return n=g(n.deref()),void(n!==t.SEMAPHORE&&(yield n));n!==t.SEMAPHORE&&(yield n)}}const A=(e,t,r=I)=>{const o=t.length-1;return n.isIterable(t[o])?t.length>1?r(e.apply(null,t.slice(0,o)),t[o]):r(e(),t[0]):void 0},M=(e,t)=>[e[0],e[1],t];function x(e,t){return n.isIterable(t)?I(x(e),t):t=>{const n=t[2];return M(t,((t,r)=>n(t,e(r))))}}function E(...e){return P(E,y,e)}const P=(e,t,n)=>{let o,i;switch(n.length){case 4:i=n[3],o=n[2];break;case 3:i=n[2];break;case 2:return x((t=>e(n[0],n[1],t)));default:r.illegalArity(n.length)}return t(l(n[0])(n[1]),o,i)},R=[t.NO_OP,t.NO_OP,t.NO_OP];const j=e=>{const{1:t,2:n}=l(e)(w());let r=!1;return e=>{if(!r){let o=n([],e);return r=d(o),r&&(o=t(o.deref())),1===o.length?o[0]:o.length>0?o:void 0}}},N=(e,t,n,r)=>{const o=v(e,r);if(void 0!==o)return o;const i=r[0]||n;return O((()=>i),t)};function H(...e){return N(H,((e,t)=>e+t),0,e)}function z(e){return e?y(z(),e):O((()=>({})),((e,[t,n])=>(e[t]=n,e)))}function q(...e){const t=v(q,e);if(void 0!==t)return t;let n=e[0]||0,r=e[1]||1;return O((()=>n),((e,t)=>e+r))}function $(...e){const t=v($,e);if(void 0!==t)return t;let n=e[0]||0;return O((()=>[]),((e,t)=>(e[n++]=t,e)))}const _=e=>Object.assign({key:o.identity,group:w()},e);function F(...e){const t=v(F,e);if(void 0!==t)return t;const n=_(e[0]),[r,o,i]=n.group;return[()=>new Map,e=>{for(let t of e.keys())e.set(t,o(e.get(t)));return e},(e,t)=>{const o=n.key(t);return e.set(o,e.has(o)?i(e.get(o),t):i(r(),t))}]}function T(...e){return v(T,e)||F({key:e[0]||o.identity,group:q()})}function L(...e){const t=v(L,e);if(t)return t;const n=_(e[0]),[r,o,i]=n.group;return[()=>({}),e=>{for(let t in e)e[t]=o(e[t]);return e},(e,t)=>{const o=n.key(t);return e[o]=e[o]?i(e[o],t):i(r(),t),e}]}const W=(e,t,n,r)=>o=>e(o)&t?r:n;function D(e){return e?y(D(),e):O((()=>-1/0),((e,t)=>Math.max(e,t)))}function K(e){return e?y(K(),e):O((()=>1/0),((e,t)=>Math.min(e,t)))}function B(...e){let[t,n,r]=e;const o=e.length;switch(o){case 1:{const e=t[2];return[()=>[t[0]()],e=>[t[1](e[0])],(t,n)=>{const r=e(t[0],n);return d(r)?a([g(r)]):[r]}]}case 2:{const e=t[2],r=n[2];return[()=>[t[0](),n[0]()],e=>[t[1](e[0]),n[1](e[1])],(t,n)=>{const o=e(t[0],n),i=r(t[1],n);return d(o)||d(i)?a([g(o),g(i)]):[o,i]}]}case 3:{const e=t[2],o=n[2],i=r[2];return[()=>[t[0](),n[0](),r[0]()],e=>[t[1](e[0]),n[1](e[1]),r[1](e[2])],(t,n)=>{const r=e(t[0],n),u=o(t[1],n),c=i(t[2],n);return d(r)||d(u)||d(c)?a([g(r),g(u),g(c)]):[r,u,c]}]}default:return[()=>e.map((e=>e[0]())),t=>e.map(((e,n)=>e[1](t[n]))),(t,n)=>{let r=!1;const i=[];for(let u=0;u<o;u++){let o=e[u][2](t[u],n);d(o)&&(r=!0,o=g(o)),i[u]=o}return r?a(i):i}]}}function C(...e){const t=v(C,e);if(void 0!==t)return t;const n=e[0];return[()=>0,e=>e/n,e=>e+1]}function Y(e,t){e=e||"";let n=!0;return t?[...t].join(e):O((()=>""),((t,r)=>(t=n?t+r:t+e+r,n=!1,t)))}const V=()=>e=>{const t=e[2];return M(e,((e,n)=>{if(n)for(let r of g(n))if(e=t(e,r),d(e))break;return d(n)?h(e):e}))};function G(e,t,n){return new J(e,t,n)}class J{constructor(e,t,n){void 0===e?(e=0,t=1/0):void 0===t&&(t=e,e=0),n=void 0===n?e<t?1:-1:n,this.from=e,this.to=t,this.step=n}*[Symbol.iterator](){let{from:e,to:t,step:n}=this;if(n>0)for(;e<t;)yield e,e+=n;else if(n<0)for(;e>t;)yield e,e+=n}$reduce(e,t){const n=this.step;if(n>0)for(let r=this.from,o=this.to;r<o&&!d(t);r+=n)t=e(t,r);else for(let r=this.from,o=this.to;r>o&&!d(t);r+=n)t=e(t,r);return t}}function*Q(...e){let t,n,o,i,u,c;switch(e.length){case 6:o=e[4],c=e[5];case 4:[t,n,i,u]=e;break;case 2:[n,u]=e,t=i=0;break;default:r.illegalArity(e.length)}const s=G(t,n,o);for(let e of G(i,u,c))for(let t of s)yield[t,e]}function*U(...e){const t=e.map((e=>e[Symbol.iterator]()));for(;;){const e=[];for(let n of t){let t=n.next();if(t.done)return;e.push(t.value)}yield e}}const X=(e,t)=>{const n=t>>1;return[...U(e,G(-n,n+1))]},Z=(e,t,n=t)=>{const r=t>>1,o=n>>1;return[...U(e,Q(-r,r+1,-o,o+1))]},ee=()=>r.illegalArgs("no kernel or kernel config");function te(e,t){return n.isIterable(t)?I(te(e),t):t=>{const n=t[2],r=e();return M(t,((e,t)=>r(t)?n(e,t):e))}}function ne(e,t){return n.isIterable(t)?I(ne(e),t):t=>{const n=t[2];let r=e;return M(t,((e,t)=>r>0?(r--,e):n(e,t)))}}function re(e,t){return n.isIterable(t)?I(re(e),t):t=>{const n=t[2];return M(t,((t,r)=>e(r)?n(t,r):t))}}function oe(e,t){return n.isIterable(t)?S(oe(e),n.isString(t)?[t]:t):t=>{const n=t[2],r=(t,o)=>{const i=e(o);if(i){for(let e of i)if(t=r(t,e),d(t))break;return t}return n(t,o)};return M(t,r)}}function ie(...e){return A(ie,e)||(t=>{const n=t[2],r=e[0];let o=e[1]||0;return M(t,((e,t)=>n(e,r(o++,t))))})}function ue(...e){return e=e.map(l),o.comp.apply(null,e)}function*ce(e,t=!0){if(e>0)for(let n=0,r=t?e+1:e;n<r;n++)yield n/e}function*se(e,t,n=!0,r=!0){const o=[...ce(e,n)];for(let e of ce(t,r))yield*x((t=>[t,e]),o)}function le(e,t){return n.isIterable(t)?S(le(e),t):ue(x(e),V())}function fe(...e){const t=A(fe,e,S);if(t)return t;let n,r,o=e[0];return"number"==typeof e[1]?(r=e[1],n=e[2]):(r=o,n=e[1]),([e,t,i])=>{let u=[],c=0;return[e,e=>(n&&u.length>0&&(e=i(e,u),u=[]),t(e)),(e,t)=>(c<=0?(u.length<o&&u.push(t),u.length===o&&(e=i(e,u),u=r<o?u.slice(r):[],c=r-o)):c--,e)]}}function ae(e,t,r,o){return n.isIterable(o)?S(ae(e,t,r),o):ue(fe(t,1),le((t=>x((n=>e(t,n)),ce(r,!1)))))}const de=e=>{if(n.isFunction(e))return e;const t=Object.keys(e[1]||{}).reduce(((t,n)=>(t[n]=de(e[1][n]),t)),{});return n=>{const r=Object.assign({},n);for(let e in t)r[e]=t[e](r[e]);return e[0](r)}};function he(...e){const t=A(he,e);if(t)return t;const n=e[0],r=!1!==e[1];return x((e=>{const t=r?Object.assign({},e):e;for(let r in n)t[r]=n[r](e[r],e);return t}))}function ge(e,t){return n.isIterable(t)?S(ge(e),t):t=>{const n=t[2];let r=e;return M(t,((e,t)=>--r>0?n(e,t):0===r?h(n(e,t)):a(e)))}}const pe=(e,t,n)=>r=>{for(;e.length&&!d(r);)r=n(r,e.shift());return t(r)};function ye(e,t){return n.isIterable(t)?S(ye(e),t):([t,n,r])=>{const o=[];return[t,pe(o,n,r),(t,n)=>(o.length===e&&o.shift(),o.push(n),t)]}}const me=e=>Object.assign({key:o.identity,compare:i.compare},e);function be(...e){return x(o.juxt.apply(null,e.map(j)))}const ke=e=>{const t=Object.keys(e),[n,r,o]=t,[i,u,c]=t.map((t=>e[t]));switch(t.length){case 3:return e=>{const t={};let s;return s=e[c],void 0!==s&&(t[o]=s),s=e[u],void 0!==s&&(t[r]=s),s=e[i],void 0!==s&&(t[n]=s),t};case 2:return e=>{const t={};let o;return o=e[u],void 0!==o&&(t[r]=o),o=e[i],void 0!==o&&(t[n]=o),t};case 1:return e=>{const t={};let r=e[i];return void 0!==r&&(t[n]=r),t};default:return n=>{let r,o;const i={};for(let u=t.length-1;u>=0;u--)r=t[u],o=n[e[r]],void 0!==o&&(i[r]=o);return i}}};function Oe(...e){const t=e.length>2&&A(Oe,e);if(t)return t;let r=e[0];if(n.isArray(r)&&(r=r.reduce(((e,t,n)=>(e[t]=n,e)),{})),e[1]){const t=Object.keys(r);return x((n=>E(ue(x((e=>[e,n[r[e]]])),re((e=>void 0!==e[1]))),e[1],t)))}return x(ke(r))}function ve(...e){return A(ve,e,S)||(([n,r,o])=>{const i=e[0],u=!0===e[1]?i():i;let c,s=t.SEMAPHORE;return[n,e=>(c&&c.length&&(e=o(e,c),c=null),r(e)),(e,n)=>{const r=u(n);return s===t.SEMAPHORE?(s=r,c=[n]):r===s?c.push(n):(c&&(e=o(e,c)),c=d(e)?null:[n],s=r),e}]})}function we(e,t){return n.isIterable(t)?S(we(e),t):ve((()=>{let t=0,n=0;return()=>(t++===e[n]&&(t=1,n=(n+1)%e.length),n)}),!0)}const Se=(e,t)=>{if(t.size<e.size)return!1;for(let n of e)if(!t.has(n))return!1;return!0},Ie=(e,t)=>{const n={};for(let r of t){const o=e.get(r);n[r]=o.shift(),!o.length&&t.delete(r)}return n};const Ae=e=>ke(e.reduce(((e,t)=>(e[t]=t,e)),{}));const Me=e=>x((t=>(e(t),t)));function*xe(e,t=1/0){for(let n=0;n<t;n++)yield e(n)}function*Ee(...e){for(let t of e)null!=t&&(yield*c.ensureIterable(t))}function*Pe(e,t=1/0){for(;t-- >0;)yield e}function*Re(e){for(let t in e)e.hasOwnProperty(t)&&(yield[t,e[t]])}function*je(...e){const t=e.length-1;if(t<0)return;const n=new Array(t+1).fill(0),r=e.map(c.ensureArrayLike),o=r.reduce(((e,t)=>e*t.length),1);for(let e=0;e<o;e++){const e=[];for(let o=t;o>=0;o--){const t=r[o];let i=n[o];i===t.length&&(n[o]=i=0,o>0&&n[o-1]++),e[o]=t[i]}n[t]++,yield e}}function*Ne(e){const t=c.ensureArray(e);let n=t.length;for(;--n>=0;)yield t[n]}e.$$reduce=v,e.$iter=A,e.Range=J,e.Reduced=f,e.add=H,e.asIterable=function*(e){yield*e},e.assocMap=function e(t){return t?y(e(),t):O((()=>new Map),((e,[t,n])=>e.set(t,n)))},e.assocObj=z,e.autoObj=function e(t,n){let r=0;return n?y(e(t),n):O((()=>({})),((e,n)=>(e[t+r++]=n,e)))},e.benchmark=function e(t){return n.isIterable(t)?I(e(),t):e=>{const t=e[2];let n=Date.now();return M(e,((e,r)=>{const o=Date.now(),i=o-n;return n=o,t(e,i)}))}},e.buildKernel1d=X,e.buildKernel2d=Z,e.cat=V,e.choices=(e,t,n=s.SYSTEM)=>xe(t?s.weightedRandom(c.ensureArray(e),t,n):()=>e[0|n.float(e.length)]),e.comp=ue,e.compR=M,e.concat=Ee,e.conj=function e(t){return t?y(e(),t):O((()=>new Set),((e,t)=>e.add(t)))},e.converge=function e(...n){return A(e,n)||(e=>{const r=e[2],o=n[0];let i=t.SEMAPHORE,u=!1;return M(e,((e,n)=>u||i!==t.SEMAPHORE&&o(i,n)?(u=!0,h(r(e,n))):(i=n,r(e,n))))})},e.convolve1d=function e(t,n){if(n)return I(e(t),n);const{src:r,width:o}=t,i=!1!==t.wrap,u=t.border||0,c=t.reduce||H;let s=t.kernel;return s||((!t.weights||!t.kwidth)&&ee(),s=X(t.weights,t.kwidth)),x((e=>E(x(((e,t,n,r,o)=>r?({0:r,1:o})=>r*e[t<-o?n+o:t>=n-o?o-1:t+o]:({0:r,1:i})=>t<-i||t>=n-i?o:r*e[t+i])(r,e,o,i,u)),c(),s)))},e.convolve2d=function e(t,n){if(n)return I(e(t),n);const{src:r,width:o,height:i}=t,u=!1!==t.wrap,c=t.border||0,s=t.reduce||H;let l=t.kernel;return l||(!(t.weights&&t.kwidth&&t.kheight)&&ee(),l=Z(t.weights,t.kwidth,t.kheight)),x((e=>E(x(((e,t,n,r,o,i,u)=>i?({0:i,1:{0:u,1:c}})=>i*e[(n<-c?o+c:n>=o-c?c-1:n+c)*r+(t<-u?r+u:t>=r-u?u-1:t+u)]:({0:i,1:{0:c,1:s}})=>t<-c||n<-s||t>=r-c||n>=o-s?u:i*e[(n+s)*r+t+c])(r,e[0],e[1],o,i,u,c)),s(),l)))},e.count=q,e.curve=function*(e,t,n=10,r=.1){const o=Math.exp(-Math.log((Math.abs(t-e)+r)/r)/n),i=(e<t?t+r:t-r)*(1-o);n>0&&(yield e);for(let t=e;--n>=0;)yield t=i+t*o},e.cycle=function*(e,t=1/0){if(t<1)return;let n=[];for(let t of e)n.push(t),yield t;if(n.length>0)for(;--t>0;)yield*n},e.dedupe=function e(...n){return A(e,n)||(e=>{const r=e[2],o=n[0];let i=t.SEMAPHORE;return M(e,o?(e,n)=>(e=i!==t.SEMAPHORE&&o(i,n)?e:r(e,n),i=n,e):(e,t)=>(e=i===t?e:r(e,t),i=t,e))})},e.deepTransform=de,e.delayed=e=>x((t=>o.delayed(t,e))),e.distinct=function e(...t){return A(e,t)||(e=>{const n=e[2],r=t[0]||{},o=r.key,i=(r.cache||(()=>new Set))();return M(e,o?(e,t)=>{const r=o(t);return i.has(r)?e:(i.add(r),n(e,t))}:(e,t)=>i.has(t)?e:(i.add(t),n(e,t)))})},e.div=function e(t,n){return n?y(e(t),n):O((()=>t),((e,t)=>e/t))},e.drop=ne,e.dropNth=function e(t,r){return n.isIterable(r)?I(e(t),r):(t=u.clamp0(t-1),te((()=>{let e=t;return()=>e-- >0||(e=t,!1)})))},e.dropWhile=function e(...t){return A(e,t)||(e=>{const n=e[2],r=t[0];let o=!0;return M(e,((e,t)=>(o=o&&r(t))?e:n(e,t)))})},e.dup=function(e){return n.isString(e)?e+e:n.isArray(e)?e.concat(e):Ee(e=c.ensureArray(e),e)},e.duplicate=function e(t=1,r){return n.isIterable(r)?S(e(t),r):e=>{const n=e[2];return M(e,((e,r)=>{for(let o=t;o>=0&&!d(e);o--)e=n(e,r);return e}))}},e.ensureReduced=h,e.every=function e(...t){const n=v(e,t);if(void 0!==n)return n;const r=t[0];return O((()=>!0),r?(e,t)=>r(t)?e:a(!1):(e,t)=>t?e:a(!1))},e.extendSides=function*(e,n=1,r=n){let o=t.SEMAPHORE;for(let r of e)n>0&&o===t.SEMAPHORE&&(yield*Pe(r,n),n=0),yield r,o=r;r>0&&o!==t.SEMAPHORE&&(yield*Pe(o,r))},e.fill=$,e.fillN=function(...e){return $(...e)},e.filter=re,e.filterFuzzy=function e(...t){const n=t.length>1&&A(e,t);if(n)return n;const r=t[0],{key:o,equiv:i}=t[1]||{};return re((e=>c.fuzzyMatch(null!=o?o(e):e,r,i)))},e.flatten=function(e){return oe((e=>n.isNotStringAndIterable(e)?e:void 0),e)},e.flattenWith=oe,e.frequencies=T,e.groupBinary=(e,t,n,r,o="l",i="r")=>{const u=n||(()=>({}));let c=L({key:W(t,1,o,i),group:r||w()});for(let n=2,r=1<<e;n<r;n<<=1)c=L({key:W(t,n,o,i),group:[u,c[1],c[2]]});return[u,c[1],c[2]]},e.groupByMap=F,e.groupByObj=L,e.indexed=function e(...t){const n=A(e,t);if(n)return n;const r=t[0]||0;return ie(((e,t)=>[r+e,t]))},e.interleave=function e(t,r){return n.isIterable(r)?S(e(t),r):e=>{const n=e[2],r="function"==typeof t?t:()=>t;return M(e,((e,t)=>(e=n(e,r()),d(e)?e:n(e,t))))}},e.interpolate=ae,e.interpolateHermite=function(e,t){return ae(((e,t)=>u.mixHermite(...e,t)),4,e,t)},e.interpolateLinear=function(e,t){return ae(((e,t)=>u.mix(...e,t)),2,e,t)},e.interpose=function e(t,r){return n.isIterable(r)?S(e(t),r):e=>{const n=e[2],r="function"==typeof t?t:()=>t;let o=!0;return M(e,((e,t)=>o?(o=!1,n(e,t)):(e=n(e,r()),d(e)?e:n(e,t))))}},e.isReduced=d,e.iterate=function*(e,t,n=1/0){for(let r=1;r<=n;r++)yield t,t=e(t,r)},e.iterator=S,e.iterator1=I,e.juxtR=B,e.keep=function e(...t){return A(e,t)||(e=>{const n=e[2],r=t[0]||o.identity;return M(e,((e,t)=>null!=r(t)?n(e,t):e))})},e.keyPermutations=e=>x((e=>z(fe(2,e))),je(...le((([e,t])=>[[e],t]),Re(e)))),e.keySelector=Ae,e.keys=function*(e){for(let t in e)e.hasOwnProperty(t)&&(yield t)},e.labeled=function e(t,r){return n.isIterable(r)?I(e(t),r):x(n.isFunction(t)?e=>[t(e),e]:e=>[t,e])},e.last=function e(n){return n?y(e(),n):O(t.NO_OP,((e,t)=>t))},e.line=(e,t,n=10)=>{const r=t-e;return x((t=>e+r*t),ce(n))},e.lookup1d=e=>t=>e[t],e.lookup2d=(e,t)=>n=>e[n[0]+n[1]*t],e.lookup3d=(e,t,n)=>{const r=t*n;return n=>e[n[0]+n[1]*t+n[2]*r]},e.map=x,e.mapDeep=function e(t,r){return n.isIterable(r)?I(e(t),r):x(de(t))},e.mapIndexed=ie,e.mapKeys=he,e.mapNth=function e(...t){const n=A(e,t);if(n)return n;let r,o,i=t[0]-1;return"number"==typeof t[1]?(r=t[1],o=t[2]):(o=t[1],r=0),e=>{const t=e[2];let n=0,u=r;return M(e,((e,r)=>{if(0===u){if(0===n)return n=i,t(e,o(r));n--}else u--;return t(e,r)}))}},e.mapVals=function e(...t){const n=A(e,t);if(n)return n;const r=t[0],o=!1!==t[1];return x((e=>{const t=o?{}:e;for(let n in e)t[n]=r(e[n]);return t}))},e.mapcat=le,e.mapcatIndexed=function e(...t){return A(e,t,S)||ue(ie(t[0],t[1]),V())},e.matchFirst=function e(t,r){return n.isIterable(r)?[...I(e(t),r)][0]:ue(re(t),ge(1))},e.matchLast=function e(t,r){return n.isIterable(r)?[...S(e(t),r)][0]:ue(re(t),ye(1))},e.max=D,e.maxCompare=function e(...t){const n=v(e,t);if(void 0!==n)return n;const r=t[0],o=t[1]||i.compare;return O(r,((e,t)=>o(e,t)>=0?e:t))},e.maxMag=function e(t){return t?y(e(),t):O((()=>0),((e,t)=>Math.abs(t)>Math.abs(e)?t:e))},e.mean=function e(t){let n=1;return t?y(e(),t):[()=>n=0,e=>n>1?e/n:e,(e,t)=>(n++,e+t)]},e.min=K,e.minCompare=function e(...t){const n=v(e,t);if(void 0!==n)return n;const r=t[0],o=t[1]||i.compare;return O(r,((e,t)=>o(e,t)<=0?e:t))},e.minMag=function e(t){return t?y(e(),t):O((()=>1/0),((e,t)=>Math.abs(t)<Math.abs(e)?t:e))},e.minMax=()=>B(K(),D()),e.movingAverage=function e(t,o){return n.isIterable(o)?I(e(t),o):e=>{(t|=0)<2&&r.illegalArgs("period must be >= 2");const n=e[2],o=[];let i=0;return M(e,((e,r)=>{const u=o.push(r);return i+=r,u>t&&(i-=o.shift()),u>=t?n(e,i/t):e}))}},e.movingMedian=function e(...t){const n=A(e,t);if(n)return n;const{key:r,compare:o}=me(t[1]),i=t[0],u=i>>1;return ue(fe(i,1,!0),x((e=>e.slice().sort(((e,t)=>o(r(e),r(t))))[u])))},e.mul=function e(...t){return N(e,((e,t)=>e*t),1,t)},e.multiplex=be,e.multiplexObj=function e(...t){const n=A(e,t);if(n)return n;const[r,o]=t,i=Object.keys(r);return ue(be.apply(null,i.map((e=>r[e]))),Oe(i,o))},e.noop=()=>e=>e,e.normCount=C,e.normFrequencies=function e(...t){return v(e,t)||F({key:t[1]||o.identity,group:C(t[0])})},e.normFrequenciesAuto=function e(...t){const n=v(e,t);if(void 0!==n)return n;const[r,o,i]=T(...t);let u=0;return[r,e=>{e=o(e);for(let t of e)e.set(t[0],t[1]/u);return e},(e,t)=>(u++,i(e,t))]},e.normRange=ce,e.normRange2d=se,e.normRange3d=function*(e,t,n,r=!0,o=!0,i=!0){const u=[...se(e,t,r,o)];for(let e of ce(n,i))yield*x((t=>[...t,e]),u)},e.padLast=function e(t,r,o){return n.isIterable(o)?S(e(t,r),o):([e,n,o])=>{let i=0;return[e,e=>{let u=i%t;if(u>0)for(;++u<=t&&!d(e);)e=o(e,r);return n(e)},(e,t)=>(i++,o(e,t))]}},e.padSides=(e,t,n=1,r=n)=>n>0?r>0?Ee(Pe(t,n),e,Pe(t,r)):Ee(Pe(t,n),e):r>0?Ee(e,Pe(t,r)):Ee(e),e.page=function e(...t){return A(e,t)||ue(ne(t[0]*(t[1]||10)),ge(t[1]||10))},e.pairs=Re,e.palindrome=function(e){return n.isString(e)?Y("",Ee([e],Ne(e))):n.isArray(e)?e.concat(e.slice().reverse()):Ee(e=c.ensureArray(e),Ne(e))},e.partition=fe,e.partitionBy=ve,e.partitionOf=we,e.partitionSort=function e(...t){const n=A(e,t,S);if(n)return n;const{key:r,compare:o}=me(t[1]);return ue(fe(t[0],!0),le((e=>e.slice().sort(((e,t)=>o(r(e),r(t)))))))},e.partitionSync=function e(...t){const i=A(e,t,S);if(i)return i;const{key:u,mergeOnly:c,reset:s,all:l,backPressure:f}=Object.assign({key:o.identity,mergeOnly:!1,reset:!0,all:!0,backPressure:0},t[1]),a=n.isArray(t[0])?new Set(t[0]):t[0],h=new Set,g=new Map;let p={};const y=([e,t,n])=>{let o=!0;return c||f<1?[e,e=>((s&&l&&h.size>0||!s&&o)&&(e=n(e,p),p={},h.clear(),o=!1),t(e)),(e,t)=>{const r=u(t);return a.has(r)&&(p[r]=t,h.add(r),(c||Se(a,h))&&(e=n(e,p),o=!1,s?(p={},h.clear()):p=Object.assign({},p))),e}]:[e,e=>(l&&h.size>0&&(e=n(e,Ie(g,h)),g.clear(),h.clear()),t(e)),(e,t)=>{const i=u(t);if(a.has(i)){let u=g.get(i);for(!u&&g.set(i,u=[]),u.length>=f&&r.illegalState(`max back pressure (${f}) exceeded for input: ${String(i)}`),u.push(t),h.add(i);Se(a,h)&&(e=n(e,Ie(g,h)),o=!1,!d(e)););}return e}]};return y.keys=()=>a,y.clear=()=>{g.clear(),a.clear(),h.clear(),p={}},y.add=e=>{a.add(e)},y.delete=(e,t=!0)=>{g.delete(e),a.delete(e),t&&(h.delete(e),delete p[e])},y},e.partitionTime=function e(t,r){return n.isIterable(r)?S(e(t),r):ve((()=>{let e=0;return()=>{const n=Date.now();return n-e>=t&&(e=n),e}}),!0)},e.partitionWhen=function e(...t){return A(e,t,S)||(([e,n,r])=>{const o=t[0],i=!0===t[1]?o():o;let u;return[e,e=>(u&&u.length&&(e=r(e,u),u=null),n(e)),(e,t)=>(i(t)?(u&&(e=r(e,u)),u=d(e)?null:[t]):u?u.push(t):u=[t],e)]})},e.peek=function(e){return x(c.peek,e)},e.permutations=je,e.permutationsN=(e,t=e,n)=>{n&&n.length<e&&r.illegalArgs(`insufficient offsets, got ${n.length}, needed ${e}`);const o=[];for(;--e>=0;){const r=n?n[e]:0;o[e]=G(r,r+t)}return je.apply(null,o)},e.pluck=function e(t,r){return n.isIterable(r)?I(e(t),r):x((e=>e[t]))},e.push=w,e.pushCopy=()=>O((()=>[]),((e,t)=>((e=e.slice()).push(t),e))),e.pushSort=function(e=i.compare,t){return t?[...t].sort(e):[()=>[],t=>t.sort(e),(e,t)=>(e.push(t),e)]},e.range=G,e.range2d=Q,e.range3d=function*(...e){let t,n,o,i,u,c,s,l,f;switch(e.length){case 9:o=e[6],c=e[7],f=e[8];case 6:[t,n,i,u,s,l]=e;break;case 3:[n,u,l]=e,t=i=s=0;break;default:r.illegalArity(e.length)}const a=G(t,n,o),d=G(i,u,c);for(let e of G(s,l,f))for(let t of d)for(let n of a)yield[n,t,e]},e.rangeNd=(e,t)=>je.apply(null,t?[...x((([e,t])=>G(e,t)),U(e,t))]:[...x(G,e)]),e.reduce=y,e.reduceRight=m,e.reduced=a,e.reducer=O,e.reductions=function e(t,n){const[r,o,i]=t;return n?y(e(t),n):[()=>[r()],e=>(e[e.length-1]=o(e[e.length-1]),e),(e,t)=>{const n=i(e[e.length-1],t);return d(n)?(e.push(n.deref()),a(e)):(e.push(n),e)}]},e.rename=Oe,e.renamer=ke,e.repeat=Pe,e.repeatedly=xe,e.reverse=Ne,e.run=function(e,...n){if(1===n.length)E(e,R,n[0]);else{const r=n[0];E(e,[t.NO_OP,t.NO_OP,(e,t)=>r(t)],n[1])}},e.sample=function e(...t){const n=A(e,t);if(n)return n;const r=t[0],o=t[1]||s.SYSTEM;return e=>{const t=e[2];return M(e,((e,n)=>o.float()<r?t(e,n):e))}},e.scan=function e(...t){return t.length>2&&A(e,t,S)||(([e,n,r])=>{const[o,i,u]=t[0];let c=t.length>1&&null!=t[1]?t[1]:o();return[e,e=>{let t=i(c);return t!==c&&(e=g(r(e,t))),c=t,n(e)},(e,t)=>(c=u(c,t),d(c)?h(r(e,c.deref())):r(e,c))]})},e.selectKeys=function e(t,r){return n.isIterable(r)?I(e(t),r):x(Ae(t))},e.sideEffect=Me,e.slidingWindow=function e(...n){const r=A(e,n);if(r)return r;const o=n[0],i=!1!==n[1];return e=>{const n=e[2];let r=[];return M(e,((e,u)=>{r.push(u);const c=t.deref(o);return(i||r.length>=c)&&(e=n(e,r),r=r.slice(r.length>=c?1:0,c)),e}))}},e.some=function e(...t){const n=v(e,t);if(void 0!==n)return n;const r=t[0];return O((()=>!1),r?(e,t)=>r(t)?a(!0):e:(e,t)=>t?a(!0):e)},e.sortedKeys=function*(e,t=i.compare){yield*Object.keys(e).sort(t)},e.step=j,e.str=Y,e.streamShuffle=function e(...t){return A(e,t,S)||(([e,n,r])=>{const o=t[0],i=t[1]||o,u=[];return[e,e=>{for(;u.length&&!d(e);)c.shuffle(u,i),e=r(e,u.shift());return e=n(e)},(e,t)=>(u.push(t),c.shuffle(u,i),u.length===o&&(e=r(e,u.shift())),e)]})},e.streamSort=function e(...t){const n=A(e,t,S);if(n)return n;const{key:r,compare:o}=me(t[1]),i=t[0];return([e,t,n])=>{const u=[];return[e,pe(u,t,n),(e,t)=>{const s=c.binarySearch(u,t,r,o);return u.splice(s<0?-(s+1):s,0,t),u.length===i&&(e=n(e,u.shift())),e}]}},e.struct=function e(t,r){return n.isIterable(r)?S(e(t),r):ue(we(t.map((e=>e[1]))),fe(t.length),Oe(t.map((e=>e[0]))),he(t.reduce(((e,t)=>t[2]?(e[t[0]]=t[2],e):e),{}),!1))},e.sub=function e(...t){return N(e,((e,t)=>e-t),0,t)},e.swizzle=function e(t,r){return n.isIterable(r)?I(e(t),r):x(c.swizzle(t))},e.symmetric=function*(e){let t;for(let n of e)t={x:n,n:t},yield n;for(;t;)yield t.x,t=t.n},e.take=ge,e.takeLast=ye,e.takeNth=function e(t,r){return n.isIterable(r)?I(e(t),r):(t=u.clamp0(t-1),te((()=>{let e=0;return()=>0===e?(e=t,!0):(e--,!1)})))},e.takeWhile=function e(...t){return A(e,t)||(e=>{const n=e[2],r=t[0];let o=!0;return M(e,((e,t)=>(o=o&&r(t))?n(e,t):a(e)))})},e.throttle=te,e.throttleTime=function e(t,r){return n.isIterable(r)?I(e(t),r):te((()=>{let e=0;return()=>{const n=Date.now();return n-e>=t&&(e=n,!0)}}))},e.toggle=function e(t,r,o=!1,i){return n.isIterable(i)?I(e(t,r,o),i):([e,n,i])=>{let u=o;return[e,n,e=>i(e,(u=!u)?t:r)]}},e.trace=(e="")=>Me((t=>console.log(e,t))),e.transduce=E,e.transduceRight=function e(...t){return P(e,m,t)},e.tween=function*(e){const{min:t,max:n,num:r,init:o,mix:i,stops:u}=e,c=e.easing||(e=>e);let s=u.length;if(s<1)return;1===s&&(yield*Pe(i(o(u[0][1],u[0][1]),0),r)),u.sort(((e,t)=>e[0]-t[0])),u[s-1][0]<n&&u.push([n,u[s-1][1]]),u[0][0]>t&&u.unshift([t,u[0][1]]);const l=n-t;let f=u[0][0],a=u[1][0],d=a-f,h=o(u[0][1],u[1][1]),g=1;s=u.length;for(let e of ce(r)){if(e=t+l*e,e>a){for(;g<s&&e>u[g][0];)g++;f=u[g-1][0],a=u[g][0],d=a-f,h=o(u[g-1][1],u[g][1])}yield i(h,c(0!==d?(e-f)/d:0))}},e.unreduced=g,e.vals=function*(e){for(let t in e)e.hasOwnProperty(t)&&(yield e[t])},e.wordWrap=function e(...t){const n=A(e,t,S);if(n)return n;const r=t[0],{delim:o,always:i}=Object.assign({delim:1,always:!0},t[1]);return ve((()=>{let e=0,t=!1;return n=>(e+=n.length+o,e>r+(i?0:o)&&(t=!t,e=n.length+o),t)}),!0)},e.wrapSides=function*(e,t=1,n=t){const o=c.ensureArray(e);if((!u.inRange(t,0,o.length)||!u.inRange(n,0,o.length))&&r.illegalArgs(`allowed wrap range: [0..${o.length}]`),t>0)for(let e=o.length,n=e-t;n<e;n++)yield o[n];if(yield*o,n>0)for(let e=0;e<n;e++)yield o[e]},e.zip=U,Object.defineProperty(e,"__esModule",{value:!0})}));